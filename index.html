<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Forecast</title>
    <meta name="description" content="Data-driven fishing guide for Bazaruto waters based on historical catch data">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" href="assets/icons/fish_forecast_icon-2.png">
    <link rel="apple-touch-icon" href="assets/icons/fish_forecast_icon-2.png">
    
    <!-- Social Media / Open Graph Tags -->
    <meta property="og:title" content="Boa Vida Fish Forecast">
    <meta property="og:description" content="Data-driven fishing guide for Bazaruto waters based on historical catch data">
    <meta property="og:image" content="https://henriken.github.io/boa-vida-fish-forecast/assets/icons/fish_forecast_icon-2.png">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Boa Vida Fish Forecast">
    <meta name="twitter:description" content="Data-driven fishing guide for Bazaruto waters based on historical catch data">
    <meta name="twitter:image" content="https://henriken.github.io/boa-vida-fish-forecast/assets/icons/fish_forecast_icon-2.png">
    
    <!-- Microsoft Tile Tags -->
    <meta name="msapplication-TileImage" content="assets/icons/fish_forecast_icon-2.png">
    <meta name="msapplication-TileColor" content="#26374D">
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#26374D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=EB+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Papa Parse for CSV parsing -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    
    <!-- Lodash for data manipulation -->
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    
    <!-- Lucide Icons (using static version instead of React components) -->
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.js"></script>
    
    <script>
        // Tailwind config extension for custom fonts
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cormorant': ['"Cormorant Garamond"', 'serif'],
                        'eb-garamond': ['"EB Garamond"', 'serif'],
                    }
                }
            }
        };
    </script>
    
    <style>

        /* Additional mobile optimizations */
        body {
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(135deg, #536D82, #26374D); /* Blue Door to True Navy gradient */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #0F172A; /* Dark text for better readability */
        }
        
        /* Ensure good contrast in bright sunlight */
        .sunlight-optimized {
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        /* Loading animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Modern card styling */
        .card {
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            background-color: #FFFFFF;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        /* Card variations */
        .card-compact {
            padding: 1.25rem;
        }
        
        .card-spacious {
            padding: 2rem;
        }
        
        /* Original color palette */
        .bg-primary {
            background-color: #26374D; /* True Navy */
        }
        
        .bg-secondary {
            background-color: #536D82; /* Blue Door */
        }
        
        .bg-accent {
            background-color: #9DB2BF; /* Harper's Blue */
        }
        
        .bg-light {
            background-color: #DDE8ED; /* Alice Blue */
        }
        
        .bg-surface {
            background-color: #FFFFFF;
        }
        
        .text-primary {
            color: #26374D; /* True Navy */
        }
        
        .text-secondary {
            color: #536D82; /* Blue Door */
        }
        
        .text-accent {
            color: #9DB2BF; /* Harper's Blue */
        }
        
        .text-muted {
            color: #64748B;
        }
        
        .border-primary {
            border-color: #26374D; /* True Navy */
        }
        
        /* Original color classes */
        .bg-true-navy {
            background-color: #26374D;
        }
        
        .bg-blue-door {
            background-color: #536D82;
        }
        
        .bg-harpers-blue {
            background-color: #9DB2BF;
        }
        
        .bg-alice-blue {
            background-color: #DDE8ED;
        }
        
        .text-true-navy {
            color: #26374D;
        }
        
        /* Material Symbols */
        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            vertical-align: middle;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        /* Material Symbols in circular backgrounds */
        .icon-wrapper .material-symbols-rounded {
            margin-right: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- IndexedDB Manager -->
    <script src="/js/indexedDB-manager.js"></script>
    
    <!-- Update Notifier -->
    <script src="/js/update-notifier.js"></script>
    
    <script>
        // Register service worker for offline capabilities
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Handle updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker is installed but waiting to activate
                                    UpdateNotifier.showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
                    
                // Listen for messages from the service worker
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                        UpdateNotifier.showUpdateNotification();
                    }
                });
            });
        }
        
        // Wait for all libraries to load before initializing the app
        function initializeApp() {
            // Check if all libraries are loaded
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined' || 
                typeof Papa === 'undefined' || typeof _ === 'undefined') {
                console.log('Waiting for libraries to load...');
                setTimeout(initializeApp, 100);
                return;
            }
            
            console.log('All libraries loaded, starting app...');
            startApp();
        }
        
        function startApp() {
            const { useState, useEffect } = React;
            
            // Create simple icon components using SVG
            const createIcon = (pathData, viewBox = "0 0 24 24") => {
                return (props) => React.createElement('svg', {
                    xmlns: "http://www.w3.org/2000/svg",
                    width: "24",
                    height: "24",
                    viewBox: viewBox,
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: "2",
                    strokeLinecap: "round",
                    strokeLinejoin: "round",
                    className: props.className,
                    style: props.style
                }, React.createElement('path', { d: pathData }));
            };
            
            // Define icon paths
            const Fish = createIcon("M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-1 3.46-3.44 6-7 6s-7.56-2.54-8.5-6Z M18 12v.01 M12 12v.01");
            const MapPin = createIcon("M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z M12 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z");
            const Sun = createIcon("M12 2v2 M12 20v2 M4.93 4.93l1.41 1.41 M17.66 17.66l1.41 1.41 M2 12h2 M20 12h2 M6.34 17.66l-1.41 1.41 M19.07 4.93l-1.41 1.41");
            const Moon = createIcon("M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z");
            const Droplets = createIcon("M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05Z M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97");
            const Clock = createIcon("M12 2a10 10 0 1 0 0 20 10 10 0 1 0 0-20Z M12 6v6l4 2");
            const TrendingUp = createIcon("M22 7L13.5 15.5 8.5 10.5 2 17 M16 7h6v6");
            const AlertCircle = createIcon("M12 2a10 10 0 1 0 0 20 10 10 0 1 0 0-20Z M12 8v4 M12 16h.01");
            const Hook = createIcon("M16 8c0-2.21-1.79-4-4-4S8 5.79 8 8v3c0 1.66-1.34 3-3 3s-3-1.34-3-3V8c0-3.31 2.69-6 6-6s6 2.69 6 6v8c0 1.1-.9 2-2 2s-2-.9-2-2v-3");
            const Worm = createIcon("M3 12c0-1.5 1-3 2.5-3.5C6.5 8 7.5 7 8.5 6.5 10 6 11.5 6.5 12.5 7.5s1.5 2.5 1 4c-.5 1.5-1.5 2.5-2.5 3.5-1 1-2.5 1.5-4 1-1.5-.5-2.5-1.5-3-3-.5-1.5-.5-3 0-4.5.5-1.5 1.5-2.5 3-3 1.5-.5 3-.5 4.5 0 1.5.5 2.5 1.5 3 3 .5 1.5.5 3 0 4.5M6 10c.5-.5 1-.5 1.5-.5s1 0 1.5.5c.5.5.5 1 .5 1.5s0 1-.5 1.5c-.5.5-1 .5-1.5.5s-1 0-1.5-.5c-.5-.5-.5-1-.5-1.5s0-1 .5-1.5");

            const SimpleFishingGuide = () => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedFish, setSelectedFish] = useState('');
            const [recommendations, setRecommendations] = useState(null);
            const [species, setSpecies] = useState([]);
            const [error, setError] = useState(null);
            const [isOnline, setIsOnline] = useState(navigator.onLine);

            useEffect(() => {
                loadData();
                
                // Set up network status monitoring
                const handleOnline = () => {
                    console.log("🌐 Network connection restored");
                    setIsOnline(true);
                    
                    // Fetch fresh data when coming back online
                    fetchAndCacheData().catch(err => {
                        console.log("Background data refresh failed after coming online:", err);
                    });
                };
                
                const handleOffline = () => {
                    console.log("⚠️ Network connection lost");
                    setIsOnline(false);
                };
                
                // Add event listeners for online/offline events
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // Clean up event listeners on component unmount
                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            const loadData = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    console.log("Starting data load process...");
                    
                    // Track whether we're using cached data
                    let usingCachedData = false;
                    
                    // First, try to load data from IndexedDB if available
                    try {
                        console.log("Checking for cached data in IndexedDB...");
                        const cachedData = await IndexedDBManager.getFishingData();
                        
                        if (cachedData) {
                            console.log("✅ Found cached data in IndexedDB, using it");
                            usingCachedData = true;
                            processData(cachedData);
                            
                            // If we're online, fetch fresh data in the background
                            if (navigator.onLine) {
                                console.log("📡 Online: Fetching fresh data in the background...");
                                fetchAndCacheData().catch(err => {
                                    console.log("Background data refresh failed, continuing with cached data");
                                });
                            }
                            return;
                        } else {
                            console.log("⚠️ No cached data found in IndexedDB");
                        }
                    } catch (err) {
                        console.error("❌ Error accessing IndexedDB:", err);
                    }
                    
                    // If no cached data or error accessing IndexedDB, fetch from network
                    if (navigator.onLine) {
                        await fetchAndCacheData();
                    } else {
                        // We're offline and have no cached data
                        throw new Error("You're offline and no cached data is available. Please connect to the internet to download fishing data.");
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };
            
            // Function to fetch data from network and cache it
            const fetchAndCacheData = async () => {
                // Try multiple possible filenames for flexibility
                const possibleFilenames = [
                    'Boa_Vida_Fish_Finder_data.csv',
                    './Boa_Vida_Fish_Finder_data.csv',
                    '../Boa_Vida_Fish_Finder_data.csv',
                    '/Boa_Vida_Fish_Finder_data.csv',
                    'data/Boa_Vida_Fish_Finder_data.csv',
                    './data/Boa_Vida_Fish_Finder_data.csv'
                ];
                
                let csvData;
                let loadedFilename = '';
                
                // Always try the direct root path first as most reliable
                try {
                    console.log("Trying direct path to CSV in root directory...");
                    const response = await fetch('/Boa_Vida_Fish_Finder_data.csv');
                    if (response.ok) {
                        csvData = await response.text();
                        loadedFilename = '/Boa_Vida_Fish_Finder_data.csv';
                        console.log(`✅ Successfully loaded from root: ${loadedFilename}`);
                        console.log(`First 50 chars: ${csvData.substring(0, 50)}`);
                    } else {
                        console.log(`❌ Root path failed with status: ${response.status}`);
                    }
                } catch (err) {
                    console.log(`❌ Error loading from root path: ${err.message}`);
                }
                
                // Try other paths if root didn't work
                if (!csvData) {
                    for (const filename of possibleFilenames) {
                        try {
                            console.log(`Trying path: ${filename}`);
                            const response = await fetch(filename);
                            if (response.ok) {
                                csvData = await response.text();
                                loadedFilename = filename;
                                console.log(`✅ Successfully loaded: ${filename}`);
                                break;
                            } else {
                                console.log(`❌ Failed with status: ${response.status}`);
                            }
                        } catch (err) {
                            console.log(`❌ Error loading: ${filename} - ${err.message}`);
                        }
                    }
                }
                
                if (!csvData) {
                    console.error('⚠️ CSV loading failed from all relative paths. Attempting absolute path...');
                    try {
                        // Last resort - try with absolute path
                        const absolutePath = window.location.origin + '/Boa_Vida_Fish_Finder_data.csv';
                        console.log('Trying absolute path:', absolutePath);
                        const response = await fetch(absolutePath);
                        if (response.ok) {
                            csvData = await response.text();
                            loadedFilename = absolutePath;
                            console.log(`✅ Successfully loaded from absolute path: ${absolutePath}`);
                        } else {
                            console.log(`❌ Absolute path failed with status: ${response.status}`);
                            throw new Error('Could not find CSV file. Please ensure Boa_Vida_Fish_Finder_data.csv is in the project directory.');
                        }
                    } catch (err) {
                        console.error('❌ All CSV loading attempts failed:', err);
                        throw new Error('Could not find CSV file. Please ensure Boa_Vida_Fish_Finder_data.csv is in the project directory.');
                    }
                }
                
                // Process the CSV data
                console.log("Starting CSV parsing...");
                Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: (results) => {
                        console.log(`✅ CSV parsed successfully. Found ${results.data.length} rows.`);
                        
                        if (results.data.length === 0) {
                            console.error("❌ No data rows found in CSV");
                            throw new Error("CSV file contains no data rows");
                        }
                        
                        if (!results.data[0].Species) {
                            console.error("❌ Missing Species column in CSV data");
                            throw new Error("CSV data is missing required Species column");
                        }
                        
                        // Process the data
                        processData(results.data);
                        
                        // Cache the raw data in IndexedDB for offline use
                        try {
                            IndexedDBManager.saveFishingData(results.data, 'csv')
                                .then(() => console.log("✅ Successfully cached fishing data in IndexedDB"))
                                .catch(err => console.error("❌ Error caching data in IndexedDB:", err));
                        } catch (err) {
                            console.error("❌ Error accessing IndexedDB for caching:", err);
                        }
                    },
                    error: (error) => {
                        throw new Error(`CSV parsing error: ${error.message}`);
                    }
                });
            };
            
            // Function to process the data (either from network or cache)
            const processData = (rawData) => {
                try {
                    const cleanedData = rawData
                        .filter(row => row.Species && row.Species.trim() !== '')
                        .map(row => {
                            // Handle column names with trailing spaces
                            const place = row.Place || row['Place '] || row['Place  '];
                            const primaryBait = row.Primary_Bait || row['Primary_Bait '] || row.Bait || row['Bait '];
                            const timeOfStrike = row['Time of Strike'] || row['Time of Strike '] || row['Time of Strike  '];
                            const weather = row.Weather || row['Weather '] || row['Weather  '];
                            
                            // Convert lbs to kg internally (0.453592 conversion factor)
                            const weightLbs = parseFloat(row['Weight (lbs)']) || 0;
                            const weightKg = weightLbs * 0.453592;
                            
                            return {
                                Species: row.Species?.trim(),
                                Weight: weightKg, // Calculated from lbs
                                WeightLbs: weightLbs,
                                Place: place?.trim() || 'Unknown',
                                PrimaryBait: primaryBait?.trim() || 'Unknown',
                                Enhancement: row.Enhancement?.trim() || '',
                                // RawBait removed as per column update
                                WaterTemp: parseFloat(row['Water Temperature (°C)'] || row['Water Temperature (C)']) || 0,
                                Moon: row.Moon?.trim() || 'Unknown',
                                TideState: row['Tide State']?.trim() || 'Unknown',
                                TimeOfStrike: timeOfStrike?.trim() || '',
                                Weather: weather?.trim() || '',
                                CloudCover: parseInt(row['Cloud Cover (%)']) || 0,
                                TideHeight: parseFloat(row['Tide Height (m)']) || 0,
                                TidalCoeff: parseInt(row['Tidal Coefficient']) || 0,
                                Length: parseFloat(row['Length (m)']) || 0,
                                LineLbs: parseFloat(row['Line (lbs)']) || 0,
                                AirTemp: parseFloat(row['Air Temp (°C)']) || 0
                            };
                        });
                    
                    console.log(`✅ Cleaned data: ${cleanedData.length} valid rows`);
                    setData(cleanedData);
                    
                    const uniqueSpecies = _.uniq(cleanedData.map(d => d.Species)).sort();
                    console.log(`✅ Found ${uniqueSpecies.length} unique species: ${uniqueSpecies.join(', ')}`);
                    setSpecies(uniqueSpecies);
                    
                    if (uniqueSpecies.length > 0) {
                        console.log(`✅ Setting selected fish to: ${uniqueSpecies[0]}`);
                        setSelectedFish(uniqueSpecies[0]);
                        analyzeSpecies(uniqueSpecies[0], cleanedData);
                    } else {
                        console.error("❌ No species found in data");
                        throw new Error("No fish species found in data");
                    }
                } catch (error) {
                    console.error('Error processing data:', error);
                    setError(error.message);
                    throw error;
                }
            };

            const analyzeSpecies = (fishSpecies, fishingData) => {
                console.log(`Analyzing species: ${fishSpecies}`);
                console.log(`Total fishing data records: ${fishingData.length}`);
                
                const speciesData = fishingData.filter(d => d.Species === fishSpecies);
                console.log(`Found ${speciesData.length} records for ${fishSpecies}`);
                
                if (speciesData.length === 0) {
                    console.error(`❌ No data found for species: ${fishSpecies}`);
                    setRecommendations(null);
                    return;
                }

                // Best locations
                console.log("Calculating best locations...");
                let locationCounts;
                try {
                    // Filter for valid location data first
                    const validLocationData = speciesData.filter(d => 
                        d.Place && d.Place.trim() !== '' && d.Place !== 'Unknown'
                    );
                    
                    console.log(`Found ${validLocationData.length} records with valid location data out of ${speciesData.length} total`);
                    
                    if (validLocationData.length === 0) {
                        console.log("⚠️ No valid location data available");
                        locationCounts = [];
                    } else {
                        locationCounts = _(validLocationData)
                        .groupBy('Place')
                        .mapValues(records => ({
                            count: records.length,
                            avgWeight: _.meanBy(records, 'WeightLbs'),
                            percentage: (records.length / validLocationData.length * 100)
                        }))
                        .entries()
                        .orderBy([1, 'count'], ['desc'])
                        .value();
                        
                        console.log(`✅ Found ${locationCounts.length} locations`);
                        if (locationCounts.length > 0) {
                            console.log(`Top location: ${locationCounts[0][0]} with ${locationCounts[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating locations:", err);
                    locationCounts = [];
                    console.log("Continuing with analysis despite location error");
                }

                // Best baits (using Primary_Bait)
                console.log("Calculating best baits...");
                let baitCounts;
                try {
                    // Filter for valid bait data first
                    const validBaitData = speciesData.filter(d => 
                        d.PrimaryBait && d.PrimaryBait.trim() !== '' && d.PrimaryBait !== 'Unknown'
                    );
                    
                    console.log(`Found ${validBaitData.length} records with valid bait data out of ${speciesData.length} total`);
                    
                    if (validBaitData.length === 0) {
                        console.log("⚠️ No valid bait data available");
                        baitCounts = [];
                    } else {
                        baitCounts = _(validBaitData)
                        .groupBy('PrimaryBait')
                        .mapValues(records => ({
                            count: records.length,
                            avgWeight: _.meanBy(records, 'WeightLbs'),
                            percentage: (records.length / validBaitData.length * 100)
                        }))
                        .entries()
                        .orderBy([1, 'count'], ['desc'])
                        .value();
                        
                        console.log(`✅ Found ${baitCounts.length} bait types`);
                        if (baitCounts.length > 0) {
                            console.log(`Top bait: ${baitCounts[0][0]} with ${baitCounts[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating baits:", err);
                    baitCounts = [];
                    console.log("Continuing with analysis despite bait error");
                }

                // Best enhancements (when used with primary bait)
                console.log("Calculating best enhancements...");
                let enhancementCounts;
                try {
                    // Filter for valid enhancement data first
                    const validEnhancementData = speciesData.filter(record => 
                        record.Enhancement && record.Enhancement.trim() !== '' && record.Enhancement !== 'Unknown'
                    );
                    
                    console.log(`Found ${validEnhancementData.length} records with valid enhancement data out of ${speciesData.length} total`);
                    
                    if (validEnhancementData.length === 0) {
                        console.log("⚠️ No valid enhancement data available");
                        enhancementCounts = [];
                    } else {
                        enhancementCounts = _(validEnhancementData)
                        .groupBy('Enhancement')
                        .mapValues(records => ({
                            count: records.length,
                            avgWeight: _.meanBy(records, 'WeightLbs'),
                            percentage: (records.length / validEnhancementData.length * 100),
                            usedWith: _.chain(records).groupBy('PrimaryBait').mapValues('length').entries().orderBy([1], ['desc']).value()[0]
                        }))
                        .entries()
                        .orderBy([1, 'count'], ['desc'])
                        .value();
                        
                        console.log(`✅ Found ${enhancementCounts.length} enhancement types`);
                        if (enhancementCounts.length > 0) {
                            console.log(`Top enhancement: ${enhancementCounts[0][0]} with ${enhancementCounts[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating enhancements:", err);
                    console.log("This is not critical, continuing with analysis...");
                    enhancementCounts = [];
                }

                // Best moon phases
                console.log("Calculating best moon phases...");
                let moonCounts;
                try {
                    // Filter for valid moon phase data first
                    const validMoonData = speciesData.filter(d => 
                        d.Moon && d.Moon.trim() !== '' && d.Moon !== 'Unknown'
                    );
                    
                    console.log(`Found ${validMoonData.length} records with valid moon phase data out of ${speciesData.length} total`);
                    
                    if (validMoonData.length === 0) {
                        console.log("⚠️ No valid moon phase data available");
                        moonCounts = [];
                    } else {
                        moonCounts = _(validMoonData)
                            .groupBy('Moon')
                            .mapValues(records => ({
                                count: records.length,
                                percentage: (records.length / validMoonData.length * 100)
                            }))
                            .entries()
                            .orderBy([1, 'count'], ['desc'])
                            .value();
                            
                        console.log(`✅ Found ${moonCounts.length} moon phases`);
                        if (moonCounts.length > 0) {
                            console.log(`Top moon phase: ${moonCounts[0][0]} with ${moonCounts[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating moon phases:", err);
                    moonCounts = [];
                    console.log("Continuing with analysis despite moon phase error");
                }

                // Best tide states
                console.log("Calculating best tide states...");
                let tideCounts;
                try {
                    // Filter for valid tide state data first
                    const validTideData = speciesData.filter(d => 
                        d.TideState && d.TideState.trim() !== '' && d.TideState !== 'Unknown'
                    );
                    
                    console.log(`Found ${validTideData.length} records with valid tide state data out of ${speciesData.length} total`);
                    
                    if (validTideData.length === 0) {
                        console.log("⚠️ No valid tide state data available");
                        tideCounts = [];
                    } else {
                        tideCounts = _(validTideData)
                            .groupBy('TideState')
                            .mapValues(records => ({
                                count: records.length,
                                percentage: (records.length / validTideData.length * 100)
                            }))
                            .entries()
                            .orderBy([1, 'count'], ['desc'])
                            .value();
                            
                        console.log(`✅ Found ${tideCounts.length} tide states`);
                        if (tideCounts.length > 0) {
                            console.log(`Top tide state: ${tideCounts[0][0]} with ${tideCounts[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating tide states:", err);
                    tideCounts = [];
                    console.log("Continuing with analysis despite tide state error");
                }

                // Best time of day
                console.log("Calculating best time of day...");
                let timeOfDay;
                try {
                    // Filter for valid time data first
                    const validTimeData = speciesData.filter(d => 
                        d.TimeOfStrike && d.TimeOfStrike.trim() !== ''
                    );
                    
                    console.log(`Found ${validTimeData.length} records with valid time data out of ${speciesData.length} total`);
                    
                    if (validTimeData.length === 0) {
                        console.log("⚠️ No valid time data available");
                        timeOfDay = [];
                    } else {
                        timeOfDay = _(validTimeData)
                            .groupBy(row => {
                                const time = row.TimeOfStrike;
                                const hour = parseInt(time.split(':')[0]);
                                if (hour >= 5 && hour < 12) return 'Morning (5am-12pm)';
                                if (hour >= 12 && hour < 17) return 'Afternoon (12pm-5pm)';
                                if (hour >= 17 && hour < 20) return 'Evening (5pm-8pm)';
                                return 'Night (8pm-5am)';
                            })
                            .mapValues(records => ({
                                count: records.length,
                                percentage: (records.length / validTimeData.length * 100)
                            }))
                            .entries()
                            .orderBy([1, 'count'], ['desc'])
                            .value();
                            
                        console.log(`✅ Found ${timeOfDay.length} time periods`);
                        if (timeOfDay.length > 0) {
                            console.log(`Top time period: ${timeOfDay[0][0]} with ${timeOfDay[0][1].count} catches`);
                        }
                    }
                } catch (err) {
                    console.error("❌ Error calculating time of day:", err);
                    timeOfDay = [];
                    console.log("Continuing with analysis despite time of day error");
                }

                // Weather conditions
                console.log("Calculating weather conditions...");
                let avgWaterTemp = null;
                let avgCloudCover = null;
                let weatherPreference = null;
                
                try {
                    // Filter for valid water temperature data
                    const validWaterTemps = speciesData.filter(d => 
                        typeof d.WaterTemp === 'number' && !isNaN(d.WaterTemp) && d.WaterTemp > 0
                    );
                    console.log(`Found ${validWaterTemps.length} records with valid water temperatures out of ${speciesData.length} total`);
                    
                    if (validWaterTemps.length > 0) {
                        avgWaterTemp = _.meanBy(validWaterTemps, 'WaterTemp');
                        console.log(`✅ Average water temperature: ${avgWaterTemp.toFixed(1)}°C`);
                    } else {
                        console.log("⚠️ No valid water temperature data available");
                    }
                    
                    // Filter for valid cloud cover data
                    const validCloudCoverData = speciesData.filter(d => 
                        typeof d.CloudCover === 'number' && !isNaN(d.CloudCover)
                    );
                    console.log(`Found ${validCloudCoverData.length} records with valid cloud cover data out of ${speciesData.length} total`);
                    
                    if (validCloudCoverData.length > 0) {
                        avgCloudCover = _.meanBy(validCloudCoverData, 'CloudCover');
                        console.log(`✅ Average cloud cover: ${avgCloudCover.toFixed(1)}%`);
                        
                        // Only set weather preference if we have valid cloud cover data
                        weatherPreference = avgCloudCover < 30 ? 'Clear skies' : 
                                           avgCloudCover < 60 ? 'Partly cloudy' : 'Overcast';
                        console.log(`✅ Weather preference: ${weatherPreference}`);
                    } else {
                        console.log("⚠️ No valid cloud cover data available");
                    }
                } catch (err) {
                    console.error("❌ Error calculating weather conditions:", err);
                    console.log("Continuing with analysis despite weather condition error");
                }

                // Create recommendations object with null checks for all values
                setRecommendations({
                    totalCatches: speciesData.length,
                    avgWeight: _.meanBy(speciesData.filter(d => typeof d.WeightLbs === 'number' && !isNaN(d.WeightLbs)), 'WeightLbs') || 0,
                    maxWeight: _.maxBy(speciesData.filter(d => typeof d.WeightLbs === 'number' && !isNaN(d.WeightLbs)), 'WeightLbs')?.WeightLbs || 0,
                    
                    // Location recommendations
                    topLocation: locationCounts.length > 0 ? locationCounts[0] : null,
                    allLocations: locationCounts.slice(0, 3),
                    
                    // Bait recommendations
                    topBait: baitCounts.length > 0 ? baitCounts[0] : null,
                    allBaits: baitCounts.slice(0, 3),
                    
                    // Enhancement recommendations
                    topEnhancement: enhancementCounts.length > 0 ? enhancementCounts[0] : null,
                    allEnhancements: enhancementCounts.slice(0, 3),
                    
                    // Moon phase recommendations
                    topMoon: moonCounts.length > 0 ? moonCounts[0] : null,
                    allMoons: moonCounts.slice(0, 3),
                    
                    // Tide state recommendations
                    topTide: tideCounts.length > 0 ? tideCounts[0] : null,
                    allTides: tideCounts.slice(0, 3),
                    
                    // Time of day recommendations
                    topTime: timeOfDay.length > 0 ? timeOfDay[0] : null,
                    allTimes: timeOfDay,
                    
                    // Weather recommendations
                    avgWaterTemp: avgWaterTemp !== null ? avgWaterTemp.toFixed(1) : null,
                    weatherPreference: weatherPreference || null
                });
            };

            const handleSpeciesChange = (newSpecies) => {
                setSelectedFish(newSpecies);
                analyzeSpecies(newSpecies, data);
            };

            if (loading) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center p-4"
                }, React.createElement('div', {
                    className: "bg-white rounded-xl p-8 text-center shadow-2xl max-w-sm mx-auto"
                }, [
                    React.createElement('div', {
                        key: 'spinner',
                        className: "animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"
                    }),
                    React.createElement('p', {
                        key: 'text',
                        className: "text-xl font-semibold sunlight-optimized"
                    }, "Loading fishing data..."),
                    React.createElement('p', {
                        key: 'subtext',
                        className: "text-gray-600 mt-2"
                    }, "Analyzing historical catches")
                ]));
            }

            if (error) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center p-4"
                }, React.createElement('div', {
                    className: "bg-white rounded-xl p-8 text-center shadow-2xl max-w-md mx-auto"
                }, [
                    React.createElement(AlertCircle, {
                        key: 'icon',
                        className: "h-16 w-16 text-red-500 mx-auto mb-4"
                    }),
                    React.createElement('p', {
                        key: 'title',
                        className: "text-xl font-semibold mb-2 sunlight-optimized"
                    }, "Data Loading Error"),
                    React.createElement('p', {
                        key: 'message',
                        className: "text-gray-600 mb-4"
                    }, error),
                    React.createElement('button', {
                        key: 'retry',
                        onClick: loadData,
                        className: "bg-blue-door text-white px-6 py-3 rounded-lg font-semibold hover:bg-true-navy transition-all"
                    }, "Try Again")
                ]));
            }

            if (!recommendations) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center p-4"
                }, React.createElement('div', {
                    className: "bg-white rounded-xl p-8 text-center shadow-2xl max-w-md mx-auto"
                }, [
                    React.createElement(AlertCircle, {
                        key: 'icon',
                        className: "h-16 w-16 text-orange-500 mx-auto mb-4"
                    }),
                    React.createElement('p', {
                        key: 'title',
                        className: "text-xl font-semibold sunlight-optimized"
                    }, "No data available"),
                    React.createElement('p', {
                        key: 'message',
                        className: "text-gray-600 mt-2"
                    }, "Please ensure the CSV file is uploaded and accessible.")
                ]));
            }

            return React.createElement('div', {
                className: "min-h-screen p-4 pb-8" // Background gradient is set in CSS
            }, React.createElement('div', {
                className: "max-w-2xl mx-auto"
            }, [
                // Offline indicator - only show when offline
                !isOnline && React.createElement('div', {
                    key: 'offline-indicator',
                    className: "bg-yellow-500 text-white px-4 py-2 text-center rounded-lg mb-4 flex items-center justify-center shadow-md"
                }, [
                    React.createElement('span', {
                        key: 'icon',
                        className: "material-symbols-rounded mr-2"
                    }, "wifi_off"),
                    React.createElement('span', {
                        key: 'text'
                    }, "You're currently offline. Using cached data.")
                ]),
                // Header
                React.createElement('div', {
                    key: 'header',
                    className: "card bg-true-navy p-6 sm:p-8 mb-6 shadow-md overflow-hidden gradient-overlay"
                }, [
                    // Home button (top left)
                    React.createElement('div', {
                        key: 'nav',
                        className: "flex justify-start mb-4"
                    }, 
                        React.createElement('a', {
                            key: 'home-btn',
                            href: 'home.html',
                            className: "inline-flex items-center justify-center gap-2 bg-white hover:bg-gray-100 text-true-navy font-medium py-2 px-4 rounded-full shadow-sm transition-colors"
                        }, [
                            // Home icon
                            React.createElement('svg', {
                                key: 'home-icon',
                                xmlns: "http://www.w3.org/2000/svg",
                                width: "16",
                                height: "16",
                                viewBox: "0 0 24 24",
                                fill: "none",
                                stroke: "currentColor",
                                strokeWidth: "2",
                                strokeLinecap: "round",
                                strokeLinejoin: "round"
                            }, [
                                React.createElement('path', {
                                    key: 'path1',
                                    d: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                                }),
                                React.createElement('polyline', {
                                    key: 'path2',
                                    points: "9 22 9 12 15 12 15 22"
                                })
                            ]),
                            "Home"
                        ])
                    ),
                    
                    React.createElement('div', {
                        key: 'content',
                    className: "text-center p-6 sm:p-10"
                }, [
                        React.createElement('h1', {
                        key: 'title',
                            className: "font-cormorant tracking-wider uppercase text-4xl sm:text-5xl font-light text-white mb-4 sm:mb-6 sunlight-optimized whitespace-nowrap",
                            style: { letterSpacing: '0.2em', wordSpacing: '0.1em' }
                        }, "BOA VIDA"),
                        React.createElement('p', {
                        key: 'subtitle',
                            className: "font-cormorant tracking-wider uppercase text-base sm:text-xl font-light text-white sunlight-optimized",
                            style: { letterSpacing: '0.3em', wordSpacing: '0.3em' }
                        }, "FISH FORECAST")
                    ])
                ]),

                // Fish Selector
                React.createElement('div', {
                    key: 'selector',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('label', {
                        key: 'label',
                        className: "block text-base font-medium text-muted mb-2"
                    }, "SELECT SPECIES"),
                    React.createElement('select', {
                        key: 'select',
                        value: selectedFish,
                        onChange: (e) => handleSpeciesChange(e.target.value),
                        className: "w-full text-xl font-semibold p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-accent focus:border-accent outline-none text-primary bg-light"
                    }, species.map(sp => React.createElement('option', {
                        key: sp,
                        value: sp
                    }, sp))),
                    
                    React.createElement('div', {
                        key: 'stats',
                        className: "mt-6 grid grid-cols-2 gap-4"
                    }, [
                        React.createElement('div', {
                            key: 'avg',
                            className: "bg-light rounded-xl p-4 flex flex-col"
                        }, [
                            React.createElement('span', {
                                key: 'label',
                                className: "text-sm text-muted mb-1"
                            }, "AVERAGE WEIGHT"),
                            React.createElement('span', {
                                key: 'value',
                                className: "text-1xl font-bold text-primary"
                            }, `${recommendations.avgWeight.toFixed(1)} lbs`)
                        ]),
                        React.createElement('div', {
                            key: 'max',
                            className: "bg-light rounded-xl p-4 flex flex-col"
                        }, [
                            React.createElement('span', {
                                key: 'label',
                                className: "text-sm text-muted mb-1"
                            }, "BIGGEST CATCH"),
                            React.createElement('span', {
                                key: 'value',
                                className: "text-1xl font-bold text-accent"
                            }, `${recommendations.maxWeight.toFixed(1)} lbs`)
                        ])
                    ])
                ]),

                // Best Location
                React.createElement('div', {
                    key: 'location',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "flex items-center mb-6"
                    }, [
                        React.createElement('div', {
                            key: 'icon-wrapper',
                            className: "bg-light rounded-full p-2 mr-3 icon-wrapper"
                        }, React.createElement('span', {
                            key: 'icon',
                            className: "material-symbols-rounded text-accent"
                        }, "location_on")),
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-xl font-semibold text-primary"
                        }, "Where to Fish")
                    ]),
                    
                    React.createElement('div', {
                        key: 'best',
                        className: "bg-light rounded-xl p-6 mb-6"
                    }, React.createElement('div', {
                        className: "text-center"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-sm text-muted uppercase mb-2"
                        }, "Best Spot"),
                        React.createElement('div', {
                            key: 'name',
                            className: "text-3xl font-bold text-primary mb-3"
                        }, recommendations.topLocation ? recommendations.topLocation[0] : "No data available"),
                        recommendations.topLocation ? React.createElement('div', {
                            key: 'stats',
                            className: "inline-flex items-center justify-center px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-medium"
                        }, `${recommendations.topLocation[1].count} catches`) : null,
                        recommendations.topLocation ? React.createElement('div', {
                            key: 'avg',
                            className: "text-sm text-muted mt-3"
                        }, `Average weight: ${recommendations.topLocation[1].avgWeight.toFixed(1)} lbs`) : null
                    ])),

                    recommendations.allLocations.length > 1 && React.createElement('div', {
                        key: 'others',
                        className: "space-y-3"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-xs font-medium text-muted uppercase"
                        }, "Other good spots"),
                        ...recommendations.allLocations.slice(1).map(([place, data], index) => 
                            React.createElement('div', {
                                key: index,
                                className: "flex justify-between items-center bg-light p-3 rounded-lg hover:bg-gray-100 transition-colors"
                            }, [
                                React.createElement('span', {
                                    key: 'name',
                                    className: "font-medium text-primary"
                                }, place),
                                React.createElement('span', {
                                    key: 'count',
                                    className: "text-xs px-2 py-1 bg-accent/10 text-accent rounded-full"
                                }, `${data.count}`)
                            ])
                        )
                    ])
                ]),

                // Best Bait
                React.createElement('div', {
                    key: 'bait',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "flex items-center mb-6"
                    }, [
                        React.createElement('div', {
                            key: 'icon-wrapper',
                            className: "bg-light rounded-full p-2 mr-3 icon-wrapper"
                        }, React.createElement('span', {
                            key: 'icon',
                            className: "material-symbols-rounded text-accent"
                        }, "phishing")),
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-xl font-semibold text-primary"
                        }, "What Bait to Use")
                    ]),
                    
                    React.createElement('div', {
                        key: 'best',
                        className: "bg-light rounded-xl p-6 mb-6"
                    }, React.createElement('div', {
                        className: "text-center"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-sm text-muted uppercase mb-2"
                        }, "Best Bait"),
                        React.createElement('div', {
                            key: 'name',
                            className: "text-3xl font-bold text-primary mb-3"
                        }, recommendations.topBait ? recommendations.topBait[0] : "No data available"),
                        recommendations.topBait ? React.createElement('div', {
                            key: 'stats',
                            className: "inline-flex items-center justify-center px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-medium"
                        }, `${recommendations.topBait[1].count} catches (${recommendations.topBait[1].percentage.toFixed(0)}%)`) : null,
                        recommendations.topBait ? React.createElement('div', {
                            key: 'avg',
                            className: "text-sm text-muted mt-3"
                        }, `Average weight: ${recommendations.topBait[1].avgWeight.toFixed(1)} lbs`) : null
                    ])),

                    recommendations.allBaits.length > 1 && React.createElement('div', {
                        key: 'others',
                        className: "space-y-3"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-xs font-medium text-muted uppercase"
                        }, "Other good baits"),
                        ...recommendations.allBaits.slice(1).map(([bait, data], index) => 
                            React.createElement('div', {
                                key: index,
                                className: "flex justify-between items-center bg-light p-3 rounded-lg hover:bg-gray-100 transition-colors"
                            }, [
                                React.createElement('span', {
                                    key: 'name',
                                    className: "font-medium text-primary"
                                }, bait),
                                React.createElement('span', {
                                    key: 'count',
                                    className: "text-xs px-2 py-1 bg-accent/10 text-accent rounded-full"
                                }, `${data.count}`)
                            ])
                        )
                    ])
                ]),

                // Best Enhancement (conditional)
                recommendations.topEnhancement && React.createElement('div', {
                    key: 'enhancement',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "flex items-center mb-6"
                    }, [
                        React.createElement('div', {
                            key: 'icon-wrapper',
                            className: "bg-light rounded-full p-2 mr-3 icon-wrapper"
                        }, React.createElement('span', {
                            key: 'icon',
                            className: "material-symbols-rounded text-accent"
                        }, "auto_awesome")),
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-xl font-semibold text-primary"
                        }, "Bait Enhancement")
                    ]),
                    
                    React.createElement('div', {
                        key: 'best',
                        className: "bg-light rounded-xl p-6 mb-6"
                    }, React.createElement('div', {
                        className: "text-center"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-sm text-muted uppercase mb-2"
                        }, "Best Enhancement"),
                        React.createElement('div', {
                            key: 'name',
                            className: "text-3xl font-bold text-primary mb-3"
                        }, recommendations.topEnhancement ? recommendations.topEnhancement[0] : "No data available"),
                        recommendations.topEnhancement ? React.createElement('div', {
                            key: 'stats',
                            className: "inline-flex items-center justify-center px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-medium"
                        }, `${recommendations.topEnhancement[1].count} catches (${recommendations.topEnhancement[1].percentage.toFixed(0)}% when used)`) : null,
                        recommendations.topEnhancement ? React.createElement('div', {
                            key: 'avg',
                            className: "text-sm text-muted mt-3"
                        }, `Average weight: ${recommendations.topEnhancement[1].avgWeight.toFixed(1)} lbs`) : null,
                        recommendations.topEnhancement && recommendations.topEnhancement[1].usedWith ? React.createElement('div', {
                            key: 'used-with',
                            className: "text-sm text-muted mt-2"
                        }, `Often used with: ${recommendations.topEnhancement[1].usedWith[0]}`) : null
                    ])),

                    recommendations.allEnhancements.length > 1 && React.createElement('div', {
                        key: 'others',
                        className: "space-y-3"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-xs font-medium text-muted uppercase"
                        }, "Other enhancements"),
                        ...recommendations.allEnhancements.slice(1).map(([enhancement, data], index) => 
                            React.createElement('div', {
                                key: index,
                                className: "flex justify-between items-center bg-light p-3 rounded-lg hover:bg-gray-100 transition-colors"
                            }, [
                                React.createElement('span', {
                                    key: 'name',
                                    className: "font-medium text-primary"
                                }, enhancement),
                                React.createElement('span', {
                                    key: 'count',
                                    className: "text-xs px-2 py-1 bg-accent/10 text-accent rounded-full"
                                }, `${data.count}`)
                            ])
                        )
                    ])
                ]),

                // Best Time
                React.createElement('div', {
                    key: 'time',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "flex items-center mb-6"
                    }, [
                        React.createElement('div', {
                            key: 'icon-wrapper',
                            className: "bg-light rounded-full p-2 mr-3 icon-wrapper"
                        }, React.createElement('span', {
                            key: 'icon',
                            className: "material-symbols-rounded text-accent"
                        }, "schedule")),
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-xl font-semibold text-primary"
                        }, "When to Fish")
                    ]),
                    
                    React.createElement('div', {
                        key: 'best',
                        className: "bg-light rounded-xl p-6 mb-6"
                    }, React.createElement('div', {
                        className: "text-center"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-sm text-muted uppercase mb-2"
                        }, "Best Time"),
                        React.createElement('div', {
                            key: 'name',
                            className: "text-3xl font-bold text-primary mb-3"
                        }, recommendations.topTime ? recommendations.topTime[0] : "No data available"),
                        recommendations.topTime ? React.createElement('div', {
                            key: 'stats',
                            className: "inline-flex items-center justify-center px-3 py-1 bg-accent/10 text-accent rounded-full text-sm font-medium"
                        }, `${recommendations.topTime[1].count} catches (${recommendations.topTime[1].percentage.toFixed(0)}%)`) : null
                    ])),

                    recommendations.allTimes.length > 1 && React.createElement('div', {
                        key: 'others',
                        className: "space-y-3"
                    }, [
                        React.createElement('div', {
                            key: 'label',
                            className: "text-xs font-medium text-muted uppercase"
                        }, "Other good times"),
                        ...recommendations.allTimes.slice(1).map(([time, data], index) => 
                        React.createElement('div', {
                            key: index,
                                className: "flex justify-between items-center bg-light p-3 rounded-lg hover:bg-gray-100 transition-colors"
                        }, [
                            React.createElement('span', {
                                key: 'name',
                                    className: "font-medium text-primary"
                            }, time),
                            React.createElement('span', {
                                key: 'count',
                                    className: "text-xs px-2 py-1 bg-accent/10 text-accent rounded-full"
                                }, `${data.count}`)
                        ])
                        )
                    ])
                ]),

                // Best Conditions
                React.createElement('div', {
                    key: 'conditions',
                    className: "card card-spacious bg-surface mb-6"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "flex items-center mb-6"
                    }, [
                        React.createElement('div', {
                            key: 'icon-wrapper',
                            className: "bg-light rounded-full p-2 mr-3 icon-wrapper"
                        }, React.createElement('span', {
                            key: 'icon',
                            className: "material-symbols-rounded text-accent"
                        }, "wb_sunny")),
                        React.createElement('h2', {
                            key: 'title',
                            className: "text-xl font-semibold text-primary"
                        }, "Best Conditions")
                    ]),
                    
                    React.createElement('div', {
                        key: 'conditions-list',
                        className: "space-y-4"
                    }, [
                        // Moon Phase
                        React.createElement('div', {
                            key: 'moon',
                            className: "bg-light rounded-xl p-4"
                        }, React.createElement('div', {
                            className: "flex items-center justify-between"
                        }, [
                            React.createElement('div', {
                                key: 'left',
                                className: "flex items-center"
                            }, [
                            React.createElement('div', {
                                key: 'icon-wrapper',
                                className: "bg-true-navy/20 rounded-full p-2 mr-3"
                            }, React.createElement(Moon, {
                                    key: 'icon',
                                className: "h-5 w-5 text-true-navy"
                            })),
                                React.createElement('div', {
                                    key: 'content'
                                }, [
                                    React.createElement('div', {
                                        key: 'label',
                                        className: "text-sm text-true-navy uppercase font-medium"
                                    }, "Moon Phase"),
                                    React.createElement('div', {
                                        key: 'value',
                                        className: "text-lg font-semibold text-true-navy"
                                    }, recommendations.topMoon ? recommendations.topMoon[0] : "No data available")
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'right',
                                className: "text-right"
                            },                                 recommendations.topMoon ? React.createElement('div', {
                                key: 'stats',
                                className: "inline-flex items-center justify-center px-3 py-1 bg-true-navy/10 text-true-navy rounded-full text-sm font-medium"
                            }, `${recommendations.topMoon[1].percentage.toFixed(0)}%`) : null)
                        ])),

                        // Tide State
                        React.createElement('div', {
                            key: 'tide',
                            className: "bg-light rounded-xl p-4"
                        }, React.createElement('div', {
                            className: "flex items-center justify-between"
                        }, [
                            React.createElement('div', {
                                key: 'left',
                                className: "flex items-center"
                            }, [
                            React.createElement('div', {
                                key: 'icon-wrapper',
                                className: "bg-true-navy/20 rounded-full p-2 mr-3"
                            }, React.createElement(Droplets, {
                                    key: 'icon',
                                className: "h-5 w-5 text-true-navy"
                            })),
                                React.createElement('div', {
                                    key: 'content'
                                }, [
                                    React.createElement('div', {
                                        key: 'label',
                                        className: "text-sm text-true-navy uppercase font-medium"
                                    }, "Tide"),
                                    React.createElement('div', {
                                        key: 'value',
                                        className: "text-lg font-semibold text-true-navy"
                                    }, recommendations.topTide ? recommendations.topTide[0] : "No data available")
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'right',
                                className: "text-right"
                            },                                 recommendations.topTide ? React.createElement('div', {
                                key: 'stats',
                                className: "inline-flex items-center justify-center px-3 py-1 bg-true-navy/10 text-true-navy rounded-full text-sm font-medium"
                            }, `${recommendations.topTide[1].percentage.toFixed(0)}%`) : null)
                        ])),

                        // Weather
                        React.createElement('div', {
                            key: 'weather',
                            className: "bg-light rounded-xl p-4"
                        }, React.createElement('div', {
                            className: "flex items-center justify-between"
                        }, [
                            React.createElement('div', {
                                key: 'left',
                                className: "flex items-center"
                            }, [
                            React.createElement('div', {
                                key: 'icon-wrapper',
                                className: "bg-true-navy/20 rounded-full p-2 mr-3"
                            }, React.createElement(Sun, {
                                    key: 'icon',
                                className: "h-5 w-5 text-true-navy"
                            })),
                                React.createElement('div', {
                                    key: 'content'
                                }, [
                                    React.createElement('div', {
                                        key: 'label',
                                        className: "text-sm text-true-navy uppercase font-medium"
                                    }, "Weather"),
                                    React.createElement('div', {
                                        key: 'value',
                                        className: "text-lg font-semibold text-true-navy"
                                    }, recommendations.weatherPreference || "No data available")
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'right',
                                className: "text-right"
                            }, [
                                React.createElement('div', {
                                    key: 'label',
                                    className: "text-sm text-true-navy"
                                }, "Water temp"),
                                React.createElement('div', {
                                    key: 'value',
                                    className: "text-xl font-bold text-true-navy sunlight-optimized"
                                }, recommendations.avgWaterTemp ? `${recommendations.avgWaterTemp}°C` : "No data")
                            ])
                        ]))
                    ])
                ]),

                // Quick Summary
                React.createElement('div', {
                    key: 'summary',
                    className: "card bg-true-navy rounded-xl p-6 text-white"
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: "mb-8 text-center"
                    }, [
                        React.createElement('h2', {
                            key: 'title',
                            className: "font-cormorant uppercase text-2xl font-medium tracking-wider text-white sunlight-optimized mb-4",
                            style: { letterSpacing: '0.2em' }
                        }, "QUICK SUMMARY")
                    ]),
                    React.createElement('div', {
                        key: 'content',
                        className: "text-lg leading-relaxed"
                    }, [
                        React.createElement('p', {
                            key: 'intro',
                            className: "mb-3 sunlight-optimized"
                        }, React.createElement('strong', null, `To catch ${selectedFish}:`)),
                        React.createElement('p', {
                            key: 'location',
                            className: "mb-2 flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "location_on"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                recommendations.topLocation ? [
                                    "Fish at ",
                                    React.createElement('strong', { key: 'loc-value' }, recommendations.topLocation[0])
                                ] : "Location data not available"
                            ])
                        ]),
                        React.createElement('p', {
                            key: 'bait',
                            className: "mb-2 flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "set_meal"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                recommendations.topBait ? [
                                    "Use ",
                                    React.createElement('strong', { key: 'bait-value' }, recommendations.topBait[0]),
                                    " bait"
                                ] : "Bait data not available"
                            ])
                        ]),
                        recommendations.topEnhancement && React.createElement('p', {
                            key: 'enhancement',
                            className: "mb-2 flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "auto_awesome"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                "Add ",
                            React.createElement('strong', { key: 'enh-value' }, recommendations.topEnhancement[0] || "Unknown"),
                            " enhancement"
                            ])
                        ]),
                        React.createElement('p', {
                            key: 'time',
                            className: "mb-2 flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "schedule"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                recommendations.topTime ? [
                                    "Go fishing ",
                                    React.createElement('strong', { key: 'time-value' }, recommendations.topTime[0].toLowerCase()),
                                    ""
                                ] : "Time data not available"
                            ])
                        ]),
                        React.createElement('p', {
                            key: 'moon',
                            className: "mb-2 flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "bedtime"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                recommendations.topMoon ? [
                                    "Best during ",
                                    React.createElement('strong', { key: 'moon-value' }, recommendations.topMoon[0]),
                                    " moon"
                                ] : "Moon phase data not available"
                            ])
                        ]),
                        React.createElement('p', {
                            key: 'tide',
                            className: "flex items-center"
                        }, [
                            React.createElement('span', {
                                key: 'icon',
                                className: "material-symbols-rounded text-white"
                            }, "waves"),
                            React.createElement('span', {
                                key: 'text'
                            }, [
                                recommendations.topTide ? [
                                    "Target ",
                                    React.createElement('strong', { key: 'tide-value' }, recommendations.topTide[0].toLowerCase()),
                                    " tide"
                                ] : "Tide data not available"
                            ])
                        ])
                    ])
                ]),

                // Footer
                React.createElement('div', {
                    key: 'footer',
                    className: "text-center mt-6 text-white text-xl"
                }, [
                    React.createElement('p', {
                        key: 'line2',
                        className: "mt-1"
                    }, "STYWE LYNE!"),
                    React.createElement('p', {
                        key: 'line3',
                        className: "text-sm mt-2 opacity-70"
                    }, "© 2025 Henrike Basson")
                ]),
                
                // Floating Action Button (Log a Catch with Google Form)
                React.createElement('a', {
                    key: 'fab',
                    href: 'https://docs.google.com/forms/d/e/1FAIpQLSdvpVR2RHX20eDRkGjjlfyyZyBwaViGhszCn7sh0DVyfhim6g/viewform?usp=header',
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    style: {
                        position: 'fixed',
                        bottom: '32px',
                        right: '32px',
                        zIndex: 900,
                        boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
                        minWidth: '56px',
                        height: '56px',
                        backgroundColor: '#9DB2BF', // Harper's Blue
                        color: '#26374D', // True Navy
                        padding: '0',
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        transition: 'all 0.2s ease',
                        transform: 'scale(1)'
                    },
                    onMouseOver: (e) => { 
                        e.currentTarget.style.transform = 'scale(1.05)';
                        e.currentTarget.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.2)';
                        e.currentTarget.style.backgroundColor = '#536D82'; // Blue Door
                    },
                    onMouseOut: (e) => { 
                        e.currentTarget.style.transform = 'scale(1)';
                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
                        e.currentTarget.style.backgroundColor = '#9DB2BF'; // Harper's Blue
                    }
                }, React.createElement('svg', {
                    xmlns: "http://www.w3.org/2000/svg",
                    width: "24",
                    height: "24",
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: "2",
                    strokeLinecap: "round",
                    strokeLinejoin: "round"
                }, [
                    React.createElement('path', { d: "M12 5v14" }),
                    React.createElement('path', { d: "M5 12h14" })
                ]))
            ]));
        };

            // Render the app
            console.log("Rendering SimpleFishingGuide component...");
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(React.createElement(SimpleFishingGuide));
            console.log("Component rendered!");
        }
        
        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
